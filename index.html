<! -- 
F1 Bingo Card Generator: https://github.com/jonahhb/F1-Bingo-Card-Generator
6 March 2023

Authors: 
Jonah Hood Blaxill: https://github.com/jonahhb
Eric Andrechek: https://github.com/EricAndrechek
-->



<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <title>F1 Bingo Card Generator</title>
  </head>
  <body>
    <script type="module">
      import { asyncRun } from "./py-worker.js";

      const init_script = `card = Bingo()`;

      const empty_context = {};

      async function begin() {
        try {
          const { results, error } = await asyncRun(init_script, empty_context);
          if (results) {
            console.log("pyodideWorker return results: ", results);
          } else if (error) {
            console.log("pyodideWorker error: ", error);
          }
        } catch (e) {
          console.log(
            `Error in pyodideWorker at ${e.filename}, Line: ${e.lineno}, ${e.message}`,
          );
        }
      }

      function downloadPDF(encoded_string) {
          let decoded_string = atob(encoded_string);
          let bytes = new Uint8Array(decoded_string.length);
          for (let i = 0; i < decoded_string.length; i++) {
              bytes[i] = decoded_string.charCodeAt(i);
          }
          let blob = new Blob([bytes], {type: "application/pdf"});
          let link = document.createElement('a');
          link.href = window.URL.createObjectURL(blob);
          let filename = "F1 Bingo Card.pdf";
          if (document.getElementById("name").value != "") {
              filename = "F1 Bingo Card - " + document.getElementById("name").value + ".pdf";
          }
          link.download = filename;
          link.click();
      }

      const save_script = `
      from js import username
      card.name(username)
      card.save()
      encoding_string = card.base64()
      encoding_string
      `;

      async function name() {
        try {
          const { results, error } = await asyncRun(save_script, {username: document.getElementById("name").value});
          if (results) {
              downloadPDF(results);
          } else if (error) {
            console.log("pyodideWorker error: ", error);
          }
        } catch (e) {
          console.log(
            `Error in pyodideWorker at ${e.filename}, Line: ${e.lineno}, ${e.message}`,
          );
        }
      }

        window.onload = function() {
            begin();
            document.getElementById("generate").addEventListener("click", generateCard);
        }
        //add event listener to the generate button so we can see that it is working
        function generateCard() {
          console.log("generate button clicked");
          //move text box and button out of the way
          document.getElementById("name").style.display = "none";
          document.getElementById("generate").style.display = "none";
          //show text saying the card is being generated
          document.getElementById("generating").style.display = "block";

          //generate the Card
          name();
        }
        function reshowGenerateButton() {
          //move text box and button back into place
          document.getElementById("name").style.display = "block";
          document.getElementById("generate").style.display = "block";
          //hide text saying the card is being generated
          document.getElementById("generating").style.display = "none";
        }
    </script>
    <div id="main">
      <h1 id="title">F1 Bingo Card Generator</h1>
      <div id="aboutSec">
        <h2 id="about">About</h2>
        <hr>
        <p id="aboutText">
          This F1 Bingo Card Generator is a simple web app that generates a bingo card for the 2023 F1 season.  This bingo card is made up of a random assortment of 
          bingo squares that are related to the 2023 F1 season (see below: Possible Squares).  The bingo card is generated using Python and the FPDF library 
          (see below: About the Generator).  Your name is only used to put it in the top left corner of the bingo card, so make it whatever you want. 
        </p>
      </div>
      <div id="generatorSec">
        <input class="gen" type="text" id="name" placeholder="Enter your name">
        <button class="gen" id="generate">Generate</button>
        <p id="generating">Generating...</p>
      </div>
      <p>Note: The name field is not required but will put a name at the top left of the bingo card.</p>
      <div id="rulesSection">
        <h2>Intended Rules</h2>
        <hr>
        The intention with the bingo squares with the small circles and red numbers is that the event in the square has to happen at least that many times in 
        the season before that event can be checked off.  For example, with the "Red Flag" square, the red flag has to be shown at least 4 times in the season.  
        Every time there was a red flag you would cross off one of the numbers in the circle.  Once all the numbers are crossed off, you can check off the square.
        <br><br>
        Other than the above mentioned regular bingo rules apply.  
        <br><br>
        At the end of the day it's all just for fun, so play it however you want!
        
        <h2>Possible Squares</h2>
        <hr>
        <div class="squares">
          <img class="squImg" src="imgs/1.png" alt="Max Won the World Drivers Championship">
          <p class="squInfoTitle">Max Won the World Drivers Championship</p>
          <p class="squInfo">This square is intended to be crossed off after Max (inevitably) wins the 2023 WDC</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/2.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/3.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/4.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/5.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/6.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/7.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/8.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/9.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/10.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/11.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/12.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/13.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/14.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/15.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/16.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/17.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/18.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <div class="squares">
          <img class="squImg" src="imgs/19.png" alt="message here">
          <p class="squInfoTitle">message here</p>
          <p class="squInfo">message here</p>
        </div>
        <h2>About the Generator</h2>
        <hr>

      </div>
    </div>
  </body>
</html>